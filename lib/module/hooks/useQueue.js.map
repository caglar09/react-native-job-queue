{"version":3,"names":["useState","useEffect","useCallback","useMemo","queue","useQueue","activeJobs","setActiveJobs","lastCompletedJobs","setLastCompletedJobs","queuedCount","filter","j","status","length","activeCount","failedCount","cancelledCount","completedCount","refreshJobs","all","getJobs","allWithDeleted","getJobsWithDeleted","completed","isDeleted","onJobAdded","job","prev","onJobStarted","map","id","onJobFailed","onJobCancelled","onJobSucceeded","onJobDeleted","addListener","removeListener"],"sources":["useQueue.tsx"],"sourcesContent":["// src/hooks/useQueue.tsx\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport queue from '../Queue';\nimport { RawJob } from '../models/Job';\nimport { Job } from '../models/Job';\n\nexport interface UseQueueState {\n    queuedCount: number;\n    activeCount: number;\n    failedCount: number;\n    cancelledCount: number;\n    completedCount: number;\n    activeJobs: RawJob[];\n    lastCompletedJobs: RawJob[];\n    refreshJobs: () => Promise<void>;\n}\n\n/**\n * useQueue hook\n *\n * Tracks the queue state:\n * - queuedCount: number of jobs waiting to start (status === 'idle')\n * - activeCount: number of jobs currently processing\n * - failedCount: number of jobs that have failed\n * - cancelledCount: number of jobs that have been cancelled\n * - completedCount: number of jobs that have completed successfully\n * - activeJobs: list of current non-deleted jobs\n * - lastCompletedJobs: list of jobs marked as deleted (completed)\n */\nexport function useQueue(): UseQueueState {\n    const [activeJobs, setActiveJobs] = useState<RawJob[]>([]);\n    const [lastCompletedJobs, setLastCompletedJobs] = useState<RawJob[]>([]);\n\n    // Derive counts from job statuses\n    const queuedCount = useMemo(() => activeJobs.filter((j) => j.status === 'idle').length, [activeJobs]);\n    const activeCount = useMemo(() => activeJobs.filter((j) => j.status === 'processing').length, [activeJobs]);\n    const failedCount = useMemo(() => activeJobs.filter((j) => j.status === 'failed').length, [activeJobs]);\n    const cancelledCount = useMemo(() => activeJobs.filter((j) => j.status === 'cancelled').length, [activeJobs]);\n    const completedCount = useMemo(() => lastCompletedJobs.length, [lastCompletedJobs]);\n\n    // Yığın içindeki işleri güncelle\n    const refreshJobs = useCallback(async () => {\n        const all = await queue.getJobs();\n        const allWithDeleted = await queue.getJobsWithDeleted();\n        const completed = allWithDeleted.filter((j) => j.isDeleted);\n        setLastCompletedJobs(completed);\n\n        setActiveJobs(all);\n    }, []);\n\n    useEffect(() => {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        refreshJobs();\n\n        // Event listener tanımları\n        const onJobAdded = (job: RawJob) => {\n            setActiveJobs((prev) => [...prev, job]);\n        };\n        const onJobStarted = (job: RawJob) => {\n            setActiveJobs((prev) => prev.map((j) => (j.id === job.id ? { ...j, ...job } : j)));\n        };\n        const onJobFailed = (job: RawJob) => {\n            setActiveJobs((prev) => prev.map((j) => (j.id === job.id ? { ...j, ...job } : j)));\n        };\n        const onJobCancelled = (job: RawJob) => {\n            setActiveJobs((prev) => prev.map((j) => (j.id === job.id ? { ...j, ...job } : j)));\n        };\n        const onJobSucceeded = (job: Job<any>) => {\n            setActiveJobs((prev) => prev.filter((j) => j.id !== job.id));\n            setLastCompletedJobs((prev) => [...prev, { ...job }]);\n        };\n        const onJobDeleted = (job: RawJob) => {\n            setActiveJobs((prev) => prev.filter((j) => j.id !== job.id));\n            setLastCompletedJobs((prev) => prev.filter((j) => j.id !== job.id));\n        };\n\n        // Subscribe\n        queue.addListener('jobAdded', onJobAdded);\n        queue.addListener('jobStarted', onJobStarted);\n        queue.addListener('jobFailed', onJobFailed);\n        queue.addListener('jobSucceeded', onJobSucceeded);\n        queue.addListener('jobDeleted', onJobDeleted);\n        queue.addListener('jobCancelled', onJobCancelled);\n\n        // Cleanup\n        return () => {\n            queue.removeListener('jobAdded', onJobAdded);\n            queue.removeListener('jobStarted', onJobStarted);\n            queue.removeListener('jobFailed', onJobFailed);\n            queue.removeListener('jobSucceeded', onJobSucceeded);\n            queue.removeListener('jobDeleted', onJobDeleted);\n            queue.removeListener('jobCancelled', onJobCancelled);\n        };\n    }, [refreshJobs]);\n\n    return {\n        queuedCount,\n        activeCount,\n        failedCount,\n        completedCount,\n        cancelledCount,\n        activeJobs,\n        lastCompletedJobs,\n        refreshJobs,\n    };\n}\n"],"mappings":"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","ignoreList":[]}