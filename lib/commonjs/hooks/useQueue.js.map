{"version":3,"names":["_react","require","_Queue","_interopRequireDefault","e","__esModule","default","useQueue","activeJobs","setActiveJobs","useState","lastCompletedJobs","setLastCompletedJobs","queuedCount","useMemo","filter","j","status","length","activeCount","failedCount","cancelledCount","completedCount","refreshJobs","useCallback","all","queue","getJobs","allWithDeleted","getJobsWithDeleted","completed","isDeleted","useEffect","onJobAdded","job","prev","onJobStarted","map","id","onJobFailed","onJobCancelled","onJobSucceeded","onJobDeleted","addListener","removeListener"],"sources":["useQueue.tsx"],"sourcesContent":["// src/hooks/useQueue.tsx\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport queue from '../Queue';\nimport { RawJob } from '../models/Job';\nimport { Job } from '../models/Job';\n\nexport interface UseQueueState {\n    queuedCount: number;\n    activeCount: number;\n    failedCount: number;\n    cancelledCount: number;\n    completedCount: number;\n    activeJobs: RawJob[];\n    lastCompletedJobs: RawJob[];\n    refreshJobs: () => Promise<void>;\n}\n\n/**\n * useQueue hook\n *\n * Tracks the queue state:\n * - queuedCount: number of jobs waiting to start (status === 'idle')\n * - activeCount: number of jobs currently processing\n * - failedCount: number of jobs that have failed\n * - cancelledCount: number of jobs that have been cancelled\n * - completedCount: number of jobs that have completed successfully\n * - activeJobs: list of current non-deleted jobs\n * - lastCompletedJobs: list of jobs marked as deleted (completed)\n */\nexport function useQueue(): UseQueueState {\n    const [activeJobs, setActiveJobs] = useState<RawJob[]>([]);\n    const [lastCompletedJobs, setLastCompletedJobs] = useState<RawJob[]>([]);\n\n    // Derive counts from job statuses\n    const queuedCount = useMemo(() => activeJobs.filter((j) => j.status === 'idle').length, [activeJobs]);\n    const activeCount = useMemo(() => activeJobs.filter((j) => j.status === 'processing').length, [activeJobs]);\n    const failedCount = useMemo(() => activeJobs.filter((j) => j.status === 'failed').length, [activeJobs]);\n    const cancelledCount = useMemo(() => activeJobs.filter((j) => j.status === 'cancelled').length, [activeJobs]);\n    const completedCount = useMemo(() => lastCompletedJobs.length, [lastCompletedJobs]);\n\n    // Yığın içindeki işleri güncelle\n    const refreshJobs = useCallback(async () => {\n        const all = await queue.getJobs();\n        const allWithDeleted = await queue.getJobsWithDeleted();\n        const completed = allWithDeleted.filter((j) => j.isDeleted);\n        setLastCompletedJobs(completed);\n\n        setActiveJobs(all);\n    }, []);\n\n    useEffect(() => {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        refreshJobs();\n\n        // Event listener tanımları\n        const onJobAdded = (job: RawJob) => {\n            setActiveJobs((prev) => [...prev, job]);\n        };\n        const onJobStarted = (job: RawJob) => {\n            setActiveJobs((prev) => prev.map((j) => (j.id === job.id ? { ...j, ...job } : j)));\n        };\n        const onJobFailed = (job: RawJob) => {\n            setActiveJobs((prev) => prev.map((j) => (j.id === job.id ? { ...j, ...job } : j)));\n        };\n        const onJobCancelled = (job: RawJob) => {\n            setActiveJobs((prev) => prev.map((j) => (j.id === job.id ? { ...j, ...job } : j)));\n        };\n        const onJobSucceeded = (job: Job<any>) => {\n            setActiveJobs((prev) => prev.filter((j) => j.id !== job.id));\n            setLastCompletedJobs((prev) => [...prev, { ...job }]);\n        };\n        const onJobDeleted = (job: RawJob) => {\n            setActiveJobs((prev) => prev.filter((j) => j.id !== job.id));\n            setLastCompletedJobs((prev) => prev.filter((j) => j.id !== job.id));\n        };\n\n        // Subscribe\n        queue.addListener('jobAdded', onJobAdded);\n        queue.addListener('jobStarted', onJobStarted);\n        queue.addListener('jobFailed', onJobFailed);\n        queue.addListener('jobSucceeded', onJobSucceeded);\n        queue.addListener('jobDeleted', onJobDeleted);\n        queue.addListener('jobCancelled', onJobCancelled);\n\n        // Cleanup\n        return () => {\n            queue.removeListener('jobAdded', onJobAdded);\n            queue.removeListener('jobStarted', onJobStarted);\n            queue.removeListener('jobFailed', onJobFailed);\n            queue.removeListener('jobSucceeded', onJobSucceeded);\n            queue.removeListener('jobDeleted', onJobDeleted);\n            queue.removeListener('jobCancelled', onJobCancelled);\n        };\n    }, [refreshJobs]);\n\n    return {\n        queuedCount,\n        activeCount,\n        failedCount,\n        completedCount,\n        cancelledCount,\n        activeJobs,\n        lastCompletedJobs,\n        refreshJobs,\n    };\n}\n"],"mappings":"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","ignoreList":[]}